#############################################################################
# syslog-ng test configuration
# Default syslog-ng.conf file which collects all local logs into a
# single file.
#
# This conf file is for local test with netcat command, e.g.:
# nc -u 127.0.0.1 7777 < some_file.txt
# or
# cat some_file.txt | nc -u 127.0.0.1 7777
#############################################################################

@version: 4.8
@include "scl.conf"

@define mypath "/tmp/test_slog/data"


options {
    flush_lines (0);
    time_reopen (10);
    log_fifo_size (1000);
    chain_hostnames (off);
    use_dns (no);
    use_fqdn (no);
    create_dirs (no);
    keep_hostname (yes);
    use-uniqid(yes);
};

source s_local {
        system();
        internal();
};

source s_network {
        network(
                transport("udp")
                port(7777)
                flags(store-raw-message)
        );
};

template slog {
         template("$(slog --key-file `mypath`/host.key --mac-file `mypath`/mac.dat $RAWMSG)\n");
};

destination d_local {
        file(`mypath`/messages.slog template(slog));
};

log {
        source(s_network);
        destination(d_local);
};

